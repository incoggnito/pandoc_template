<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>demo</title>
  <style>
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style>
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<hr />
<h2 id="title-eus-kerberos-ssl-and-oud-a-guideline-subtitle-demo-scripts-examples-and-exercises-author-stefan-oehrli-date-2018-november-01-tvddocversion-09-papersize-a4-listings-disable-line-numbers-true-titlepage-true-toc-true-toc-own-page-true-lof-true-lot-true-thanks-hans-fritz-meiner-frau-und-der-familie">title: "EUS, Kerberos, SSL and OUD a guideline" subtitle: "Demo Scripts, Examples and Exercises" author: [Stefan Oehrli] date: "2018 November 01" tvddocversion: 0.9 papersize: a4 listings-disable-line-numbers: true titlepage: true toc: true toc-own-page: true lof: true lot: true thanks: "Hans, Fritz, meiner Frau und der Familie"</h2>
<h1 id="demos-eus-kerberos-ssl-and-oud-a-guideline">Demos EUS, Kerberos, SSL and OUD a guideline</h1>
<p>A couple of demo's for the TechEvent presentation <em>EUS, Kerberos, SSL and OUD a guideline</em>. Be aware, that the code can not be used copy/past in all environments due to limitations on the line breaks.</p>
<p>Demos are shown on an Oracle 18c Docker based database.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1"><span class="ex">docker</span> run --detach --name te2018_eusdb \</a>
<a class="sourceLine" id="cb1-2" title="2">  --volume /data/docker/volumes/te2018_eusdb:/u01 \</a>
<a class="sourceLine" id="cb1-3" title="3">  -e ORACLE_SID=TE18EUS \</a>
<a class="sourceLine" id="cb1-4" title="4">  -p 1521:1521 -p 5500:5500 \</a>
<a class="sourceLine" id="cb1-5" title="5">  --hostname te2018_eusdb.postgasse.org \</a>
<a class="sourceLine" id="cb1-6" title="6">  --dns 192.168.56.70 \</a>
<a class="sourceLine" id="cb1-7" title="7">  --dns-search postgasse.org \</a>
<a class="sourceLine" id="cb1-8" title="8">  oracle/database:18.3.0.0</a></code></pre></div>
<p>Create user and roles</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">CREATE</span> <span class="kw">ROLE</span> tvd_connect;</a>
<a class="sourceLine" id="cb2-2" title="2"><span class="kw">GRANT</span> <span class="kw">CREATE</span> <span class="kw">SESSION</span> <span class="kw">TO</span> tvd_connect;</a>
<a class="sourceLine" id="cb2-3" title="3"><span class="kw">GRANT</span> <span class="kw">select</span> <span class="kw">ON</span> v_$session <span class="kw">TO</span> tvd_connect;</a>
<a class="sourceLine" id="cb2-4" title="4"><span class="kw">CREATE</span> <span class="fu">USER</span> SOE_KERBEROS <span class="kw">IDENTIFIED</span> <span class="kw">EXTERNALLY</span> <span class="kw">AS</span> <span class="st">&#39;soe@POSTGASSE.ORG&#39;</span>;</a>
<a class="sourceLine" id="cb2-5" title="5"><span class="kw">GRANT</span> tvd_connect <span class="kw">TO</span> SOE_KERBEROS;</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th>ID</th>
<th>Test</th>
<th>Comment</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>wieso</td>
<td>halt Here's a sentence with a footnote. [^1]</td>
</tr>
<tr class="even">
<td>2</td>
<td>wieso</td>
<td>halt text <a href="temehrst.">^2</a></td>
</tr>
<tr class="odd">
<td>3</td>
<td>wieso</td>
<td>halt text</td>
</tr>
<tr class="even">
<td>4</td>
<td>wieso</td>
<td>halt text</td>
</tr>
<tr class="odd">
<td>5</td>
<td>wieso</td>
<td>halt text</td>
</tr>
</tbody>
</table>
<p>etwas test dazwischen</p>
<table>
<thead>
<tr class="header">
<th>Version</th>
<th>Windows</th>
<th>HPUX</th>
<th>AIX</th>
<th>Solaris</th>
<th>Linux 64bit</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>RDBMS 18.1.0.0</td>
<td></td>
<td>n/a</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>RDBMS 18.2.0.0</td>
<td></td>
<td>n/a</td>
<td><strong>Ok</strong></td>
<td></td>
<td><em><strong>Ok</strong></em></td>
</tr>
<tr class="odd">
<td>RDBMS 18.3.0.0</td>
<td></td>
<td>n/a</td>
<td></td>
<td>NOk</td>
<td></td>
</tr>
<tr class="even">
<td>RDBMS 18.3.0.0</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>RDBMS 18.1.0.0</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>Here's a sentence with a footnote. <a href="wieso">^3</a></p>
<p>[^1]: This is the footnote.</p>
<p>ein Bild zum Anschauen</p>
<p><img src="images/LabEnvironment.png" alt="&quot;Lab Environment&quot;" /> <em>Abb. 1: Architektur Lab Umgebung</em></p>
<h2 id="password-verifier">Password Verifier</h2>
<p>Clean up and remove the old users.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode SQL"><code class="sourceCode sql"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">DROP</span> <span class="fu">USER</span> user_10g;</a>
<a class="sourceLine" id="cb3-2" title="2"><span class="kw">DROP</span> <span class="fu">USER</span> user_11g;</a>
<a class="sourceLine" id="cb3-3" title="3"><span class="kw">DROP</span> <span class="fu">USER</span> user_12c;</a>
<a class="sourceLine" id="cb3-4" title="4"><span class="kw">DROP</span> <span class="fu">USER</span> user_all;</a></code></pre></div>
<p>Create 4 dedicated test user and grant them <em>CREATE SESSION</em>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode SQL"><code class="sourceCode sql"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">GRANT</span> <span class="kw">CREATE</span> <span class="kw">SESSION</span> <span class="kw">TO</span> user_10g <span class="kw">IDENTIFIED</span> <span class="kw">BY</span> manager;</a>
<a class="sourceLine" id="cb4-2" title="2"><span class="kw">GRANT</span> <span class="kw">CREATE</span> <span class="kw">SESSION</span> <span class="kw">TO</span> user_11g <span class="kw">IDENTIFIED</span> <span class="kw">BY</span> manager;</a>
<a class="sourceLine" id="cb4-3" title="3"><span class="kw">GRANT</span> <span class="kw">CREATE</span> <span class="kw">SESSION</span> <span class="kw">TO</span> user_12c <span class="kw">IDENTIFIED</span> <span class="kw">BY</span> manager;</a>
<a class="sourceLine" id="cb4-4" title="4"><span class="kw">GRANT</span> <span class="kw">CREATE</span> <span class="kw">SESSION</span> <span class="kw">TO</span> user_all <span class="kw">IDENTIFIED</span> <span class="kw">BY</span> manager;</a></code></pre></div>
<p>Reset all passwords using <em>IDENTIFIED BY VALUES</em> to explicitly set a particular password verifier.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode SQL"><code class="sourceCode sql"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">ALTER</span> <span class="fu">USER</span> user_10g <span class="kw">IDENTIFIED</span> <span class="kw">BY</span> <span class="kw">VALUES</span> <span class="st">&#39;808E79166793CFD1&#39;</span>;</a>
<a class="sourceLine" id="cb5-2" title="2"><span class="kw">ALTER</span> <span class="fu">USER</span> user_11g <span class="kw">IDENTIFIED</span> <span class="kw">BY</span> <span class="kw">VALUES</span> <span class="st">&#39;S:22D8239017006EBDE054108BF367F</span></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="st">                                        225B5E731D12C91A3BEB31FA28D4A38&#39;</span>;</a>
<a class="sourceLine" id="cb5-4" title="4"><span class="kw">ALTER</span> <span class="fu">USER</span> user_12c <span class="kw">IDENTIFIED</span> <span class="kw">BY</span> <span class="kw">VALUES</span> <span class="st">&#39;T:C6CE7A88CC5D0E048F32A564D2B6A7</span></a>
<a class="sourceLine" id="cb5-5" title="5"><span class="st">                                        BDC78A2092184F28D13A90FC071F804E5E</span></a>
<a class="sourceLine" id="cb5-6" title="6"><span class="st">                                        A09D4D2A3749AA79BFD0A90D18DEC5788D</span></a>
<a class="sourceLine" id="cb5-7" title="7"><span class="st">                                        2B8754AE20EE5C309DBA87550E8AA15EAF</span></a>
<a class="sourceLine" id="cb5-8" title="8"><span class="st">                                        2746ED431BF4543D2ABE33E22678&#39;</span>;</a></code></pre></div>
<p>See what we do have in <em>dba_users</em>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode SQL"><code class="sourceCode sql"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">set</span> linesize <span class="dv">160</span> pagesize <span class="dv">200</span></a>
<a class="sourceLine" id="cb6-2" title="2">col username <span class="cf">for</span> a25</a>
<a class="sourceLine" id="cb6-3" title="3"><span class="kw">SELECT</span> username,password_versions <span class="kw">FROM</span> dba_users <span class="kw">WHERE</span> username <span class="kw">LIKE</span> <span class="st">&#39;USER_%&#39;</span> <span class="kw">ORDER</span> <span class="kw">BY</span> <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb6-4" title="4"></a>
<a class="sourceLine" id="cb6-5" title="5">USERNAME          PASSWORD_VERSIONS</a>
<a class="sourceLine" id="cb6-6" title="6"><span class="co">------------------------- -----------------</span></a>
<a class="sourceLine" id="cb6-7" title="7">USER_10G          10G</a>
<a class="sourceLine" id="cb6-8" title="8">USER_11G          11G</a>
<a class="sourceLine" id="cb6-9" title="9">USER_12C          12C</a>
<a class="sourceLine" id="cb6-10" title="10">USER_ALL          10G 11G 12C</a></code></pre></div>
<p>See what we do have in <em>user$</em>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode SQL"><code class="sourceCode sql"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">set</span> linesize <span class="dv">160</span> pagesize <span class="dv">200</span></a>
<a class="sourceLine" id="cb7-2" title="2">col name <span class="cf">for</span> a20</a>
<a class="sourceLine" id="cb7-3" title="3">col <span class="kw">password</span> <span class="cf">for</span> a20</a>
<a class="sourceLine" id="cb7-4" title="4">col spare4 <span class="cf">for</span> a65</a>
<a class="sourceLine" id="cb7-5" title="5"><span class="kw">SELECT</span> name,<span class="kw">password</span>,spare4 <span class="kw">FROM</span> user$ </a>
<a class="sourceLine" id="cb7-6" title="6">    <span class="kw">WHERE</span> name <span class="kw">LIKE</span> <span class="st">&#39;USER_%&#39;</span> <span class="kw">ORDER</span> <span class="kw">BY</span> <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb7-7" title="7"></a>
<a class="sourceLine" id="cb7-8" title="8">NAME       <span class="kw">PASSWORD</span>          SPARE4</a>
<a class="sourceLine" id="cb7-9" title="9"><span class="co">---------- ----------------- --------------------------------------------</span></a>
<a class="sourceLine" id="cb7-10" title="10">USER_10G   <span class="fl">808E79166793</span>CFD1</a>
<a class="sourceLine" id="cb7-11" title="11">USER_11G                     S<span class="ch">:22D8239017006EBDE054108BF367F225B5E731D12C</span></a>
<a class="sourceLine" id="cb7-12" title="12">                             91A3BEB31FA28D4A38</a>
<a class="sourceLine" id="cb7-13" title="13">USER_12C                     T<span class="ch">:C6CE7A88CC5D0E048F32A564D2B6A7BDC78A209218</span></a>
<a class="sourceLine" id="cb7-14" title="14">                             4F28D13A90FC071F804E5EA09D4D2A3749AA79BFD0A9</a>
<a class="sourceLine" id="cb7-15" title="15">                             0D18DEC5788D2B8754AE20EE5C309DBA87550E8AA15E</a>
<a class="sourceLine" id="cb7-16" title="16">                             AF2746ED431BF4543D2ABE33E22678</a>
<a class="sourceLine" id="cb7-17" title="17"></a>
<a class="sourceLine" id="cb7-18" title="18">USER_ALL   BFD595809B6149CB  S<span class="ch">:804A87EA761505458FDED9B057A77FCF53DA3DDBD6</span></a>
<a class="sourceLine" id="cb7-19" title="19">                             EDB168501EDF5C0B10;T<span class="ch">:7950DF0D54DEA24F1764EBC</span></a>
<a class="sourceLine" id="cb7-20" title="20">                             34A262D784E18F4292510B8A2E0D0F7ADFEC1C6F1E22</a>
<a class="sourceLine" id="cb7-21" title="21">                             D841A9D91BAF0B9B05632F6D4898C6F4AE1EEF150933</a>
<a class="sourceLine" id="cb7-22" title="22">                             9EBCE261A1F36E834A5E2DD9F1E772AB2D6413CCAB5E</a>
<a class="sourceLine" id="cb7-23" title="23">                             B0B23</a></code></pre></div>
<p>Check what we do have in <em>sqlnet.ora</em>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode SQL"><code class="sourceCode sql"><a class="sourceLine" id="cb8-1" title="1">host grep <span class="op">-</span>i ALLOWED <span class="op">/</span>u00<span class="op">/</span>app<span class="op">/</span>oracle<span class="op">/</span><span class="kw">network</span><span class="op">/</span><span class="kw">admin</span><span class="op">/</span>sqlnet.ora</a>
<a class="sourceLine" id="cb8-2" title="2">#SQLNET.ALLOWED_LOGON_VERSION_CLIENT<span class="op">=</span>12a</a>
<a class="sourceLine" id="cb8-3" title="3">SQLNET.ALLOWED_LOGON_VERSION_SERVER<span class="op">=</span><span class="dv">11</span></a>
<a class="sourceLine" id="cb8-4" title="4"></a>
<a class="sourceLine" id="cb8-5" title="5">host sed <span class="op">-</span>i <span class="ot">&quot;s|^SQLNET.ALLOWED_LOGON_VERSION_SERVER.*|SQLNET.ALLOWED_LOGON_VERSION_SERVER=11|&quot;</span> \</a>
<a class="sourceLine" id="cb8-6" title="6">    <span class="op">/</span>u00<span class="op">/</span>app<span class="op">/</span>oracle<span class="op">/</span><span class="kw">network</span><span class="op">/</span><span class="kw">admin</span><span class="op">/</span>sqlnet.ora</a>
<a class="sourceLine" id="cb8-7" title="7">host sed <span class="op">-</span>i <span class="ot">&quot;s|^SQLNET.ALLOWED_LOGON_VERSION_SERVER.*|SQLNET.ALLOWED_LOGON_VERSION_SERVER=12|&quot;</span> \</a>
<a class="sourceLine" id="cb8-8" title="8">    <span class="op">/</span>u00<span class="op">/</span>app<span class="op">/</span>oracle<span class="op">/</span><span class="kw">network</span><span class="op">/</span><span class="kw">admin</span><span class="op">/</span>sqlnet.ora</a>
<a class="sourceLine" id="cb8-9" title="9">host sed <span class="op">-</span>i <span class="ot">&quot;s|^SQLNET.ALLOWED_LOGON_VERSION_SERVER.*|SQLNET.ALLOWED_LOGON_VERSION_SERVER=12a|&quot;</span> \</a>
<a class="sourceLine" id="cb8-10" title="10">    <span class="op">/</span>u00<span class="op">/</span>app<span class="op">/</span>oracle<span class="op">/</span><span class="kw">network</span><span class="op">/</span><span class="kw">admin</span><span class="op">/</span>sqlnet.ora</a></code></pre></div>
<p>Do some login tests</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode SQL"><code class="sourceCode sql"><a class="sourceLine" id="cb9-1" title="1">SQL<span class="op">&gt;</span> <span class="kw">connect</span> user_10g<span class="op">/</span>manager</a>
<a class="sourceLine" id="cb9-2" title="2">ERROR:</a>
<a class="sourceLine" id="cb9-3" title="3">ORA<span class="op">-</span><span class="dv">01017</span>: invalid username<span class="op">/</span><span class="kw">password</span>; <span class="kw">logon</span> denied</a>
<a class="sourceLine" id="cb9-4" title="4"></a>
<a class="sourceLine" id="cb9-5" title="5"></a>
<a class="sourceLine" id="cb9-6" title="6">Warning: You are <span class="kw">no</span> longer connected <span class="kw">to</span> ORACLE.</a>
<a class="sourceLine" id="cb9-7" title="7"></a>
<a class="sourceLine" id="cb9-8" title="8"><span class="kw">connect</span> user_11g<span class="op">/</span>manager</a></code></pre></div>
<h2 id="setup-kerberos">Setup Kerberos</h2>
<p>Check the configuration scripts in <em>sqlnet.ora</em>.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb10-1" title="1"><span class="fu">grep</span> -i -A 11 -B 2 <span class="st">&quot;Kerberos Configuration&quot;</span> <span class="va">$TNS_ADMIN</span>/sqlnet.ora</a>
<a class="sourceLine" id="cb10-2" title="2"></a>
<a class="sourceLine" id="cb10-3" title="3"><span class="co">##########################################################################</span></a>
<a class="sourceLine" id="cb10-4" title="4"><span class="co"># Kerberos Configuration</span></a>
<a class="sourceLine" id="cb10-5" title="5"><span class="co">##########################################################################</span></a>
<a class="sourceLine" id="cb10-6" title="6"><span class="ex">SQLNET.AUTHENTICATION_SERVICES</span> = (BEQ,KERBEROS5)</a>
<a class="sourceLine" id="cb10-7" title="7"><span class="co">#SQLNET.AUTHENTICATION_SERVICES = (ALL)</span></a>
<a class="sourceLine" id="cb10-8" title="8"><span class="ex">SQLNET.FALLBACK_AUTHENTICATION</span> = TRUE</a>
<a class="sourceLine" id="cb10-9" title="9"><span class="ex">SQLNET.KERBEROS5_KEYTAB</span> = /u00/app/oracle/network/admin/urania.keytab</a>
<a class="sourceLine" id="cb10-10" title="10"><span class="ex">SQLNET.KERBEROS5_REALMS</span> = /u00/app/oracle/network/admin/krb.realms</a>
<a class="sourceLine" id="cb10-11" title="11"><span class="ex">SQLNET.KERBEROS5_CC_NAME</span> = /u00/app/oracle/network/admin/krbcache</a>
<a class="sourceLine" id="cb10-12" title="12"><span class="ex">SQLNET.KERBEROS5_CONF</span> = /u00/app/oracle/network/admin/krb5.conf</a>
<a class="sourceLine" id="cb10-13" title="13"><span class="ex">SQLNET.KERBEROS5_CONF_MIT</span>=TRUE</a>
<a class="sourceLine" id="cb10-14" title="14"><span class="ex">SQLNET.AUTHENTICATION_KERBEROS5_SERVICE</span> = oracle</a></code></pre></div>
<p>Check the configuration scripts in <em>krb5.conf</em>.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb11-1" title="1"><span class="fu">cat</span> <span class="va">$TNS_ADMIN</span>/krb5.conf</a>
<a class="sourceLine" id="cb11-2" title="2"></a>
<a class="sourceLine" id="cb11-3" title="3"><span class="co">####krb5.conf DB Server</span></a>
<a class="sourceLine" id="cb11-4" title="4">[<span class="ex">logging</span>]</a>
<a class="sourceLine" id="cb11-5" title="5"><span class="ex">default</span> = FILE:/u00/app/oracle/network/log/krb5lib.log</a>
<a class="sourceLine" id="cb11-6" title="6"><span class="va">kdc=</span>FILE:/u00/app/oracle/network/log/krb5kdc.log</a>
<a class="sourceLine" id="cb11-7" title="7"><span class="va">admin_server=</span>FILE:/u00/app/oracle/network/log/kadmind.log</a>
<a class="sourceLine" id="cb11-8" title="8"></a>
<a class="sourceLine" id="cb11-9" title="9">[<span class="ex">libdefaults</span>]</a>
<a class="sourceLine" id="cb11-10" title="10"> <span class="ex">default_realm</span> = POSTGASSE.ORG</a>
<a class="sourceLine" id="cb11-11" title="11"> <span class="va">clockskew=</span>300</a>
<a class="sourceLine" id="cb11-12" title="12"> <span class="ex">ticket_lifetime</span> = 24h</a>
<a class="sourceLine" id="cb11-13" title="13"> <span class="ex">renew_lifetime</span> = 7d</a>
<a class="sourceLine" id="cb11-14" title="14"> <span class="ex">forwardable</span> = true</a>
<a class="sourceLine" id="cb11-15" title="15"></a>
<a class="sourceLine" id="cb11-16" title="16">[<span class="ex">realms</span>]</a>
<a class="sourceLine" id="cb11-17" title="17"> <span class="ex">POSTGASSE.ORG</span> = {</a>
<a class="sourceLine" id="cb11-18" title="18">   <span class="ex">kdc</span> = mneme.postgasse.org</a>
<a class="sourceLine" id="cb11-19" title="19">   <span class="ex">admin_server</span> = mneme.postgasse.org</a>
<a class="sourceLine" id="cb11-20" title="20">}</a>
<a class="sourceLine" id="cb11-21" title="21"></a>
<a class="sourceLine" id="cb11-22" title="22">[<span class="ex">domain_realm</span>]</a>
<a class="sourceLine" id="cb11-23" title="23"><span class="ex">.postgasse.org</span> = POSTGASSE.ORG</a>
<a class="sourceLine" id="cb11-24" title="24"><span class="ex">postgasse.org</span> = POSTGASSE.ORG</a></code></pre></div>
<p>lookup hostname's and check DNS configuration</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb12-1" title="1"><span class="fu">cat</span> /etc/resolv.conf</a>
<a class="sourceLine" id="cb12-2" title="2"><span class="co"># Generated by NetworkManager</span></a>
<a class="sourceLine" id="cb12-3" title="3"><span class="ex">search</span> aux.lan postgasse.org</a>
<a class="sourceLine" id="cb12-4" title="4"><span class="ex">nameserver</span> 192.168.56.70</a>
<a class="sourceLine" id="cb12-5" title="5"><span class="ex">nameserver</span> 10.154.0.1</a></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb13-1" title="1"><span class="ex">nslookup</span> mneme.postgasse.org</a>
<a class="sourceLine" id="cb13-2" title="2"><span class="ex">Server</span>:     192.168.56.70</a>
<a class="sourceLine" id="cb13-3" title="3"><span class="ex">Address</span>:    192.168.56.70#53</a>
<a class="sourceLine" id="cb13-4" title="4"></a>
<a class="sourceLine" id="cb13-5" title="5"><span class="ex">Name</span>:   mneme.postgasse.org</a>
<a class="sourceLine" id="cb13-6" title="6"><span class="ex">Address</span>: 192.168.56.70</a>
<a class="sourceLine" id="cb13-7" title="7"><span class="ex">Name</span>:   mneme.postgasse.org</a>
<a class="sourceLine" id="cb13-8" title="8"><span class="ex">Address</span>: 10.0.2.19</a></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb14-1" title="1"><span class="ex">nslookup</span> te2018_eusdb.postgasse.org</a>
<a class="sourceLine" id="cb14-2" title="2"><span class="ex">Server</span>:     192.168.56.70</a>
<a class="sourceLine" id="cb14-3" title="3"><span class="ex">Address</span>:    192.168.56.70#53</a>
<a class="sourceLine" id="cb14-4" title="4"></a>
<a class="sourceLine" id="cb14-5" title="5"><span class="ex">Name</span>:   urania.postgasse.org</a>
<a class="sourceLine" id="cb14-6" title="6"><span class="ex">Address</span>: 192.168.56.90</a></code></pre></div>
<p>Create a service principle in MS AD</p>
<p>Create the keytab file</p>
<pre class="batch"><code>ktpass.exe -princ oracle/te2018_eusdb.postgasse.org@POSTGASSE.ORG \
    -mapuser te2018_eusdb.postgasse.org -pass manager \
    -crypto ALL -ptype KRB5_NT_PRINCIPAL \
    -out C:\u00\app\oracle\network\te2018_eusdb.keytab
</code></pre>
<p>Connect as kerberos User</p>
<h2 id="setup-oud-ad-proxy">Setup OUD AD Proxy</h2>
<h3 id="requirements">Requirements</h3>
<p>Before you can start you may need a few things.</p>
<ul>
<li>Docker environment (eg. Docker community edition)</li>
<li>OUD Docker Images in particular one for OUD 12.2.1.3 with the latest OUD base see <a href="https://github.com/oehrlis/docker">oehrlis/docker</a> soon you may also get the Dockerfiles from the Oracle Repository see <a href="https://github.com/oracle/docker-images/pull/911">pull request 911</a></li>
<li>An MS AD Directory server or at lease a few credential to access one</li>
</ul>
<h3 id="environment-variable">Environment Variable</h3>
<p>To type less you just have to define a few environment variables. Basically you will define the local Docker volume path, container name, container hostname and the OUD instance name.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb16-1" title="1"><span class="bu">export</span> <span class="va">MY_CONTAINER=</span><span class="st">&quot;te2018_oud&quot;</span></a>
<a class="sourceLine" id="cb16-2" title="2"><span class="bu">export</span> <span class="va">MY_VOLUME_PATH=</span><span class="st">&quot;/data/docker/volumes/</span><span class="va">$MY_CONTAINER</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb16-3" title="3"><span class="bu">export</span> <span class="va">MY_HOST=</span><span class="st">&quot;</span><span class="va">$MY_CONTAINER</span><span class="st">.postgasse.org&quot;</span></a>
<a class="sourceLine" id="cb16-4" title="4"><span class="bu">export</span> <span class="va">MY_OUD_INSTANCE=</span><span class="st">&quot;oud_adproxy&quot;</span></a></code></pre></div>
<h3 id="create-the-container">Create the container</h3>
<p>Just create a container without starting it. Adjust ports, base DN etc.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb17-1" title="1"><span class="ex">docker</span> container create --name <span class="va">$MY_CONTAINER</span> \</a>
<a class="sourceLine" id="cb17-2" title="2">    --volume <span class="va">$MY_VOLUME_PATH</span>:/u01 \</a>
<a class="sourceLine" id="cb17-3" title="3">    -p 1389:1389 -p 1636:1636 -p 4444:4444 \</a>
<a class="sourceLine" id="cb17-4" title="4">    -e OUD_CUSTOM=TRUE \</a>
<a class="sourceLine" id="cb17-5" title="5">    -e BASEDN=<span class="st">&quot;dc=postgasse,dc=org&quot;</span> \</a>
<a class="sourceLine" id="cb17-6" title="6">    -e OUD_INSTANCE=<span class="va">$MY_OUD_INSTANCE</span> \</a>
<a class="sourceLine" id="cb17-7" title="7">    --hostname <span class="va">$MY_HOST</span> \</a>
<a class="sourceLine" id="cb17-8" title="8">    --dns 192.168.56.70 \</a>
<a class="sourceLine" id="cb17-9" title="9">    --dns-search postgasse.org \</a>
<a class="sourceLine" id="cb17-10" title="10">    oracle/oud:12.2.1.3.180626</a></code></pre></div>
<p>Get and configure your create scripts out of the container from the OUD base. Alternatively you may also get it directly from GitHub <a href="https://github.com/oehrlis/oudbase">oehrlis/oudbase</a>.</p>
<p>Get the OUD EUS AD templates from the Docker container created before.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb18-1" title="1"><span class="fu">mkdir</span> -p <span class="va">$MY_VOLUME_PATH</span>/admin/<span class="va">$MY_OUD_INSTANCE</span></a>
<a class="sourceLine" id="cb18-2" title="2"><span class="ex">docker</span> cp \</a>
<a class="sourceLine" id="cb18-3" title="3">    <span class="va">$(</span><span class="ex">docker</span> ps -aqf <span class="st">&quot;name=</span><span class="va">$MY_CONTAINER</span><span class="st">&quot;</span><span class="va">)</span>:/u00/app/oracle/local/oudbase/templates/create/oud12c_eus_ad_proxy \</a>
<a class="sourceLine" id="cb18-4" title="4">    <span class="va">$MY_VOLUME_PATH</span>/admin/<span class="va">$MY_OUD_INSTANCE</span></a>
<a class="sourceLine" id="cb18-5" title="5"><span class="fu">mv</span> <span class="va">$MY_VOLUME_PATH</span>/admin/<span class="va">$MY_OUD_INSTANCE</span>/oud12c_eus_ad_proxy <span class="va">$MY_VOLUME_PATH</span>/admin/<span class="va">$MY_OUD_INSTANCE</span>/create</a>
<a class="sourceLine" id="cb18-6" title="6"><span class="fu">mkdir</span> -p <span class="va">$MY_VOLUME_PATH</span>/admin/<span class="va">$MY_OUD_INSTANCE</span>/etc</a>
<a class="sourceLine" id="cb18-7" title="7"><span class="bu">echo</span> <span class="st">&quot;manager&quot;</span> <span class="op">&gt;</span><span class="va">$MY_VOLUME_PATH</span>/admin/<span class="va">$MY_OUD_INSTANCE</span>/etc/<span class="va">${MY_OUD_INSTANCE}</span>_pwd.txt</a></code></pre></div>
<p>Update the <em>00_init_environment</em> according to your environment. In particular the variables AD_PDC_HOST,AD_PDC_PORT, AD_PDC_USER, AD_PDC_PASSWORD and BASEDN, GROUP_DN, USER_DN</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb19-1" title="1"><span class="ex">vi</span> <span class="va">$MY_VOLUME_PATH</span>/admin/<span class="va">$MY_OUD_INSTANCE</span>/create/00_init_environment</a>
<a class="sourceLine" id="cb19-2" title="2"></a>
<a class="sourceLine" id="cb19-3" title="3"><span class="fu">sed</span> -i -e <span class="st">&quot;s|&lt;PDC_HOSTNAME&gt;|mneme.postgasse.org|g&quot;</span> \</a>
<a class="sourceLine" id="cb19-4" title="4">    <span class="va">$MY_VOLUME_PATH</span>/admin/<span class="va">$MY_OUD_INSTANCE</span>/create/00_init_environment</a>
<a class="sourceLine" id="cb19-5" title="5"><span class="fu">sed</span> -i -e <span class="st">&#39;s|&lt;USER_DN&gt;|CN=OUD\\ Admin,CN=Users,dc=postgasse,dc=org|g&#39;</span> \</a>
<a class="sourceLine" id="cb19-6" title="6">    <span class="va">$MY_VOLUME_PATH</span>/admin/<span class="va">$MY_OUD_INSTANCE</span>/create/00_init_environment</a>
<a class="sourceLine" id="cb19-7" title="7"><span class="fu">sed</span> -i -e <span class="st">&quot;s|&lt;PASSWORD&gt;|manager|g&quot;</span> \</a>
<a class="sourceLine" id="cb19-8" title="8">    <span class="va">$MY_VOLUME_PATH</span>/admin/<span class="va">$MY_OUD_INSTANCE</span>/create/00_init_environment</a>
<a class="sourceLine" id="cb19-9" title="9"></a>
<a class="sourceLine" id="cb19-10" title="10"><span class="fu">sed</span> -i -e <span class="st">&#39;s|^export BASEDN.*|export BASEDN=&quot;dc=postgasse,dc=org&quot;|g&#39;</span> \</a>
<a class="sourceLine" id="cb19-11" title="11">    <span class="va">$MY_VOLUME_PATH</span>/admin/<span class="va">$MY_OUD_INSTANCE</span>/create/00_init_environment</a>
<a class="sourceLine" id="cb19-12" title="12"><span class="fu">sed</span> -i -e <span class="st">&#39;s|^export GROUP_OU.*|export GROUP_OU=&quot;ou=Groups,dc=postgasse,dc=org&quot;|g&#39;</span> \</a>
<a class="sourceLine" id="cb19-13" title="13">    <span class="va">$MY_VOLUME_PATH</span>/admin/<span class="va">$MY_OUD_INSTANCE</span>/create/00_init_environment</a>
<a class="sourceLine" id="cb19-14" title="14"><span class="fu">sed</span> -i -e <span class="st">&#39;s|^export USER_OU.*|export USER_OU=&quot;ou=People,dc=postgasse,dc=org&quot;|g&#39;</span> \</a>
<a class="sourceLine" id="cb19-15" title="15">    <span class="va">$MY_VOLUME_PATH</span>/admin/<span class="va">$MY_OUD_INSTANCE</span>/create/00_init_environment</a>
<a class="sourceLine" id="cb19-16" title="16"><span class="fu">sed</span> -i -e <span class="st">&quot;s|dc=example,dc=com|dc=postgasse,dc=org|g&quot;</span> \</a>
<a class="sourceLine" id="cb19-17" title="17">    <span class="va">$MY_VOLUME_PATH</span>/admin/<span class="va">$MY_OUD_INSTANCE</span>/create/00_init_environment</a>
<a class="sourceLine" id="cb19-18" title="18"></a>
<a class="sourceLine" id="cb19-19" title="19"><span class="fu">cat</span> <span class="va">$MY_VOLUME_PATH</span>/admin/<span class="va">$MY_OUD_INSTANCE</span>/create/00_init_environment</a></code></pre></div>
<p>Lets go. Start the container and let the scripts create the OUD instance.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb20-1" title="1"><span class="ex">docker</span> start <span class="va">$MY_CONTAINER</span></a></code></pre></div>
<p>Enjoy the log and see how your OUD EUS AD proxy is created</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb21-1" title="1"><span class="ex">docker</span> logs -f <span class="va">$MY_CONTAINER</span></a></code></pre></div>
<h2 id="setup-eus">Setup EUS</h2>
<!-- Register an Oracle Database using DBCA -->

<div class="sourceCode" id="cb22"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb22-1" title="1"><span class="ex">dbca</span> -configureDatabase -sourceDB <span class="va">$ORACLE_SID</span> -registerWithDirService true \</a>
<a class="sourceLine" id="cb22-2" title="2">    -dirServiceUserName <span class="st">&quot;cn=eusadmin&quot;</span> -dirServicePassword manager \</a>
<a class="sourceLine" id="cb22-3" title="3">    -walletPassword TVD04manager -silent</a></code></pre></div>
<p>Create a global DB User</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb23-1" title="1"><span class="kw">DROP</span> <span class="fu">USER</span> eus_users;</a>
<a class="sourceLine" id="cb23-2" title="2"><span class="kw">CREATE</span> <span class="fu">USER</span> eus_users <span class="kw">IDENTIFIED</span> <span class="kw">GLOBALLY</span>;  </a>
<a class="sourceLine" id="cb23-3" title="3"><span class="kw">GRANT</span> tvd_connect <span class="kw">TO</span> eus_users;  </a></code></pre></div>
<p>Define a EUS mapping to the shared schema created before</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb24-1" title="1"><span class="ex">eusm</span> createMapping database_name=<span class="st">&quot;</span><span class="va">$ORACLE_SID</span><span class="st">&quot;</span> \</a>
<a class="sourceLine" id="cb24-2" title="2">    realm_dn=<span class="st">&quot;dc=postgasse,dc=org&quot;</span> map_type=SUBTREE \</a>
<a class="sourceLine" id="cb24-3" title="3">    map_dn=<span class="st">&quot;ou=People,dc=postgasse,dc=org&quot;</span> schema=EUS_USERS \</a>
<a class="sourceLine" id="cb24-4" title="4">    ldap_host=<span class="st">&quot;te2018_oud.postgasse.org&quot;</span> ldap_port=1389 ldap_user_dn=<span class="st">&quot;cn=eusadmin&quot;</span> \</a>
<a class="sourceLine" id="cb24-5" title="5">    ldap_user_password=<span class="st">&quot;manager&quot;</span>  </a></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb25-1" title="1"><span class="ex">eusm</span> listMappings database_name=<span class="st">&quot;</span><span class="va">$ORACLE_SID</span><span class="st">&quot;</span> \</a>
<a class="sourceLine" id="cb25-2" title="2">    realm_dn=<span class="st">&quot;dc=postgasse,dc=org&quot;</span> \</a>
<a class="sourceLine" id="cb25-3" title="3">    ldap_host=<span class="st">&quot;te2018_oud.postgasse.org&quot;</span> ldap_port=1389 ldap_user_dn=<span class="st">&quot;cn=eusadmin&quot;</span> \</a>
<a class="sourceLine" id="cb25-4" title="4">    ldap_user_password=<span class="st">&quot;manager&quot;</span></a></code></pre></div>
<p>Passwords are in docker logs or in the password files in <code>$MY_VOLUME_PATH/admin/$MY_OUD_INSTANCE/etc</code></p>
<p>check EUS connection</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb26-1" title="1">SQL<span class="op">&gt;</span> conn dinu<span class="op">/</span>manager</a>
<a class="sourceLine" id="cb26-2" title="2">Connected.</a>
<a class="sourceLine" id="cb26-3" title="3">SQL<span class="op">&gt;</span> @sousrinf</a>
<a class="sourceLine" id="cb26-4" title="4"><span class="kw">Database</span> Information</a>
<a class="sourceLine" id="cb26-5" title="5"><span class="co">--------------------</span></a>
<a class="sourceLine" id="cb26-6" title="6"><span class="op">-</span> DB_NAME       : TDB122A</a>
<a class="sourceLine" id="cb26-7" title="7"><span class="op">-</span> DB_DOMAIN     :</a>
<a class="sourceLine" id="cb26-8" title="8"><span class="op">-</span> <span class="kw">INSTANCE</span>      : <span class="dv">1</span></a>
<a class="sourceLine" id="cb26-9" title="9"><span class="op">-</span> INSTANCE_NAME     : TDB122A</a>
<a class="sourceLine" id="cb26-10" title="10"><span class="op">-</span> SERVER_HOST       : urania</a>
<a class="sourceLine" id="cb26-11" title="11"><span class="op">-</span></a>
<a class="sourceLine" id="cb26-12" title="12">Authentification Information</a>
<a class="sourceLine" id="cb26-13" title="13"><span class="co">----------------------------</span></a>
<a class="sourceLine" id="cb26-14" title="14"><span class="op">-</span> SESSION_USER      : EUS_USERS</a>
<a class="sourceLine" id="cb26-15" title="15"><span class="op">-</span> PROXY_USER        :</a>
<a class="sourceLine" id="cb26-16" title="16"><span class="op">-</span> AUTHENTICATION_METHOD : <span class="kw">PASSWORD</span></a>
<a class="sourceLine" id="cb26-17" title="17"><span class="op">-</span> IDENTIFICATION_TYPE   : <span class="kw">GLOBAL</span> <span class="kw">SHARED</span></a>
<a class="sourceLine" id="cb26-18" title="18"><span class="op">-</span> NETWORK_PROTOCOL  :</a>
<a class="sourceLine" id="cb26-19" title="19"><span class="op">-</span> OS_USER       : oracle</a>
<a class="sourceLine" id="cb26-20" title="20"><span class="op">-</span> AUTHENTICATED_IDENTITY: DINU</a>
<a class="sourceLine" id="cb26-21" title="21"><span class="op">-</span> ENTERPRISE_IDENTITY   : cn<span class="op">=</span>Martin Berger,ou<span class="op">=</span>People,dc<span class="op">=</span>postgasse,dc<span class="op">=</span>org</a>
<a class="sourceLine" id="cb26-22" title="22"><span class="op">-</span></a>
<a class="sourceLine" id="cb26-23" title="23">Other Information</a>
<a class="sourceLine" id="cb26-24" title="24"><span class="co">-----------------</span></a>
<a class="sourceLine" id="cb26-25" title="25"><span class="op">-</span> ISDBA         : <span class="kw">FALSE</span></a>
<a class="sourceLine" id="cb26-26" title="26"><span class="op">-</span> CLIENT_INFO       :</a>
<a class="sourceLine" id="cb26-27" title="27"><span class="op">-</span> PROGRAM       : sqlplus@urania (TNS V1<span class="op">-</span>V3)</a>
<a class="sourceLine" id="cb26-28" title="28"><span class="op">-</span> MODULE        : SQL<span class="op">*</span>Plus</a>
<a class="sourceLine" id="cb26-29" title="29"><span class="op">-</span> IP_ADDRESS        :</a>
<a class="sourceLine" id="cb26-30" title="30"><span class="op">-</span> SID           : <span class="dv">33</span></a>
<a class="sourceLine" id="cb26-31" title="31"><span class="op">-</span> SERIAL#       : <span class="dv">17568</span></a>
<a class="sourceLine" id="cb26-32" title="32"><span class="op">-</span> SERVER        : DEDICATED</a>
<a class="sourceLine" id="cb26-33" title="33"><span class="op">-</span> TERMINAL      : pts<span class="op">/</span><span class="dv">1</span></a>
<a class="sourceLine" id="cb26-34" title="34"></a>
<a class="sourceLine" id="cb26-35" title="35">PL<span class="op">/</span>SQL <span class="kw">procedure</span> successfully completed.</a></code></pre></div>
</body>
</html>
